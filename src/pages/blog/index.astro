---
import { getCollection } from 'astro:content'
import Layout from '../../Layout.astro'
import BlogCard from '../../components/blog/BlogCard.astro'
import Breadcrumb from '@components/blog/Breadcrumb.astro'
import Footer from '@components/Footer.astro'
import BookPromo from '@components/blog/BookPromo.astro'
import { SITE_URL } from '@lib/const'

// Get all blog posts, sorted by date (newest first)
const posts = (await getCollection('blog')).sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
)

const pageTitle = 'Blog - Node.js Design Patterns'
const pageDescription =
  'Learn Node.js patterns, best practices, and advanced techniques through in-depth articles and tutorials from the authors of Node.js Design Patterns.'
---

<Layout
  title={pageTitle}
  description={pageDescription}
  ogTitle="Blog - Node.js Design Patterns"
  ogDescription={pageDescription}
  canonical={`${SITE_URL}/blog/`}
>
  <main class="min-h-screen bg-base-100">
    <header class="bg-gradient-to-b from-primary/40 to-primary/10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Breadcrumbs -->
        <Breadcrumb sections={[{ title: 'Blog', url: '/blog' }]} />

        <h1
          class="text-4xl lg:text-5xl font-bold font-heading text-base-content mb-6 leading-tight"
        >
          Node.js Design Patterns Blog
        </h1>

        <p class="text-xl text-base-content/80 leading-relaxed mb-8 max-w-3xl">
          Learn Node.js patterns, best practices, and advanced techniques
          through in-depth articles and tutorials from the authors of Node.js
          Design Patterns.
        </p>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <h2
        class="text-2xl lg:text-3xl font-bold font-heading text-base-content mb-6 leading-tight"
      >
        Latest articles from the blog
      </h2>
      <div class="flex flex-col md:flex-row gap-12">
        <!-- Blog Posts -->
        <section class="flex-1 min-w-0">
          {
            posts.length === 0 ? (
              <div class="text-center py-12">
                <p class="text-base-content/70 text-lg">
                  No blog posts available yet. Check back soon!
                </p>
              </div>
            ) : (
              <div class="grid gap-8 md:grid-cols-2">
                {posts.map((post, tabindex) => (
                  <BlogCard post={post} tabindex={tabindex} />
                ))}
              </div>
            )
          }
        </section>
        <aside class="w-full md:w-60 lg:w-70 xl:w-80 md:flex-shrink-0">
          <div class="md:sticky md:top-20 max-w-80">
            <BookPromo />
          </div>
        </aside>
      </div>
    </div>
  </main>
  <Footer />
</Layout>
